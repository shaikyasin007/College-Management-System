<!doctype html>
<html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Announcements – Faculty Console</title><link rel="stylesheet" href="../styles.css"/>
<style>:root{--bg1:#0b1220;--bg2:#0a1b2e}body{margin:0;background:linear-gradient(180deg,var(--bg2),var(--bg1));color:#e7e9f3}.wrap{width:min(1160px,96%);margin:0 auto 40px}.nav{position:fixed;top:0;left:0;right:0;background:linear-gradient(180deg, rgba(10,20,40,.95), rgba(10,20,40,.85));border-bottom:1px solid rgba(148,163,184,.2);backdrop-filter:blur(10px);z-index:10}.nav-inner{max-width:1160px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;justify-content:space-between}main{padding-top:76px}.card{border:1px solid rgba(148,163,184,.28);border-radius:18px;padding:18px;background:linear-gradient(180deg, rgba(2,6,23,.86), rgba(2,6,23,.72));backdrop-filter:blur(12px);box-shadow:0 24px 60px rgba(2,6,23,.55)}.form-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px 14px}.form-grid .field input,.form-grid .field select,.form-grid .field textarea{border-radius:12px;border:1px solid rgba(148,163,184,.35);background:rgba(15,23,42,.96);padding:10px 12px;width:100%}.data-table{width:100%;border-collapse:separate;border-spacing:0 6px}.data-table thead th{font-weight:600;color:#cbd5f5;font-size:12px;padding:8px 10px;border-bottom:1px solid rgba(148,163,184,.25)}.data-table tbody td{font-size:12px;color:#e5e7eb;padding:8px 10px;background:rgba(2,6,23,.45)}</style></head>
<body><header class="nav"><div class="nav-inner"><div class="nav-left"><strong>Heema Institute of Technology</strong><div class="nav-sub">Faculty Console</div></div><div class="nav-right"><a class="btn btn-outline" href="dashboard.html">← Back to Dashboard</a><button class="btn btn-outline" onclick="Auth.logout()">Logout</button></div></div></header>
<main class="wrap">
<section class="card" style="margin-top:14px"><h2 style="margin:0 0 6px">Announcements</h2><div class="form-grid" style="margin-top:12px"><div class="field"><label>Classes</label><select id="cls" multiple></select></div><div class="field"><label>Title</label><input id="title" type="text" placeholder="e.g. Quiz on Friday"/></div><div class="field"><label>Message</label><textarea id="msg" rows="2" placeholder="Details"></textarea></div><div class="field"><button class="btn btn-primary" id="post" type="button">Post Announcement</button></div></div></section>
<section class="card" style="margin-top:16px"><h3 style="margin:0 0 8px">History</h3><table class="data-table" id="tbl"><thead><tr><th align="left">When</th><th align="left">Title</th><th align="left">Classes</th></tr></thead><tbody></tbody></table></section>
</main>
<script>const API='https://college-management-system-s2yf.onrender.com'; const fid=sessionStorage.getItem('auth_user_id')||''; if((sessionStorage.getItem('auth_role')||'')!=='faculty'){window.location.href='../login.html'}
async function base(){ const r=await fetch(API+'/api/faculty/me',{headers:{'X-Faculty-Id':fid}}); const d=await r.json(); const classes=(d.faculty?.classes||[]); document.getElementById('cls').innerHTML=classes.map(c=>`<option value="${c.id}">${c.name}</option>`).join(''); await loadHistory(); }
function render(items){ const tbody=document.querySelector('#tbl tbody'); if(!items||!items.length){ tbody.innerHTML=`<tr><td colspan="3" style="color:#9fb0c5">No announcements yet.</td></tr>`; return;} tbody.innerHTML=items.map(a=>`<tr><td>${String(a.created_at||'').slice(0,19).replace('T',' ')}</td><td>${a.title}</td><td>${a.class_name||'All assigned classes'}</td></tr>`).join(''); }
async function loadHistory(){ const r=await fetch(API+'/api/faculty/announcements',{headers:{'X-Faculty-Id':fid}}); const d=await r.json(); render(d.items||[]); }
async function post(){ const title=document.getElementById('title').value.trim(); const body=document.getElementById('msg').value.trim(); const sel=[...document.getElementById('cls').selectedOptions].map(o=>Number(o.value)); if(!title){alert('Title required'); return;} if(sel.length===0){ // broadcast to all assigned classes by sending null class_id
  const r=await fetch(API+'/api/faculty/announcements',{method:'POST',headers:{'Content-Type':'application/json','X-Faculty-Id':fid},body:JSON.stringify({class_id:null,title,body})}); const d=await r.json(); if(!r.ok){ alert(d.error||'Failed'); return;} }
else{
  for(const cid of sel){ const r=await fetch(API+'/api/faculty/announcements',{method:'POST',headers:{'Content-Type':'application/json','X-Faculty-Id':fid},body:JSON.stringify({class_id:cid,title,body})}); const d=await r.json(); if(!r.ok){ alert(d.error||'Failed for class '+cid); return;} }
}
document.getElementById('title').value=''; document.getElementById('msg').value=''; await loadHistory(); }
document.getElementById('post').addEventListener('click', post);
(async()=>{await base()})();</script>
</body></html>
