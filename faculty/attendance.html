<!doctype html>
<html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Attendance – Faculty Console</title><link rel="stylesheet" href="../styles.css"/>
<style>:root{--bg1:#0b1220;--bg2:#0a1b2e}body{margin:0;background:linear-gradient(180deg,var(--bg2),var(--bg1));color:#e7e9f3}.wrap{width:min(1160px,96%);margin:0 auto 40px}.nav{position:fixed;top:0;left:0;right:0;background:linear-gradient(180deg, rgba(10,20,40,.95), rgba(10,20,40,.85));border-bottom:1px solid rgba(148,163,184,.2);backdrop-filter:blur(10px);z-index:10}.nav-inner{max-width:1160px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;justify-content:space-between}main{padding-top:76px}.card{border:1px solid rgba(148,163,184,.28);border-radius:18px;padding:18px;background:linear-gradient(180deg, rgba(2,6,23,.86), rgba(2,6,23,.72));backdrop-filter:blur(12px);box-shadow:0 24px 60px rgba(2,6,23,.55)}.form-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px 14px}.form-grid .field input,.form-grid .field select{border-radius:12px;border:1px solid rgba(148,163,184,.35);background:rgba(15,23,42,.96);padding:10px 12px;width:100%}.data-table{width:100%;border-collapse:separate;border-spacing:0 6px}.data-table thead th{font-weight:600;color:#cbd5f5;font-size:12px;padding:8px 10px;border-bottom:1px solid rgba(148,163,184,.25)}.data-table tbody td{font-size:12px;color:#e5e7eb;padding:8px 10px;background:rgba(2,6,23,.45)}</style></head>
<body><header class="nav"><div class="nav-inner"><div class="nav-left"><strong>Heema Institute of Technology</strong><div class="nav-sub">Faculty Console</div></div><div class="nav-right"><a class="btn btn-outline" href="dashboard.html">← Back to Dashboard</a><button class="btn btn-outline" onclick="Auth.logout()">Logout</button></div></div></header>
<main class="wrap">
<section class="card" style="margin-top:14px"><h2 style="margin:0 0 6px">Attendance</h2><div class="form-grid" style="margin-top:12px"><div class="field"><label>Class</label><select id="cls"></select></div><div class="field"><label>Date</label><input id="dt" type="date"/></div><div class="field"><button class="btn btn-primary" id="load" type="button">Load Roster</button></div></div></section>
<section class="card" style="margin-top:16px"><table class="data-table" id="tbl"><thead><tr><th align="left">Student</th><th align="left">Present</th><th align="left">Reason</th></tr></thead><tbody></tbody></table><div style="margin-top:10px"><button class="btn btn-primary" id="save" type="button">Save Attendance</button></div></section>
</main>
<script>const API='https://college-management-system-s2yf.onrender.com'; const fid=sessionStorage.getItem('auth_user_id')||''; if((sessionStorage.getItem('auth_role')||'')!=='faculty'){window.location.href='../login.html'}
async function base(){ const r=await fetch(API+'/api/faculty/me',{headers:{'X-Faculty-Id':fid}}); const d=await r.json(); const classes=(d.faculty?.classes||[]); document.getElementById('cls').innerHTML=classes.map(c=>`<option value="${c.id}">${c.name}</option>`).join(''); }
function renderRoster(students, existing){ const map=new Map((existing||[]).map(x=>[x.student_id, !!x.present])); const t=document.querySelector('#tbl tbody'); t.innerHTML=students.map(s=>`<tr data-id="${s.id}"><td>${s.name}</td><td><input type="checkbox" ${map.get(s.id)?'checked':''}/></td><td></td></tr>`).join(''); }
async function loadRoster(){ const classId=Number(document.getElementById('cls').value); const date=document.getElementById('dt').value; if(!classId||!date){alert('Select class and date'); return;} const [r1,r2]=await Promise.all([
 fetch(API+`/api/faculty/roster?class_id=${classId}`,{headers:{'X-Faculty-Id':fid}}),
 fetch(API+`/api/faculty/attendance?class_id=${classId}&date=${encodeURIComponent(date)}`,{headers:{'X-Faculty-Id':fid}})
]); const d1=await r1.json(); const d2=await r2.json(); renderRoster(d1.students||[], d2.items||[]); }
async function saveAttendance(){ const classId=Number(document.getElementById('cls').value); const date=document.getElementById('dt').value; if(!classId||!date){alert('Select class and date'); return;} const rows=[...document.querySelectorAll('#tbl tbody tr')]; const items=rows.map(tr=>({student_id:Number(tr.getAttribute('data-id')), present:tr.querySelector('input[type=checkbox]').checked})); const r=await fetch(API+'/api/faculty/attendance',{method:'POST',headers:{'Content-Type':'application/json','X-Faculty-Id':fid},body:JSON.stringify({class_id:classId,date,items})}); const d=await r.json(); if(!r.ok){alert(d.error||'Failed to save');} else {alert('Saved');}}
document.getElementById('load').addEventListener('click', loadRoster);
document.getElementById('save').addEventListener('click', saveAttendance);
(async()=>{await base()})();</script>
</body></html>
