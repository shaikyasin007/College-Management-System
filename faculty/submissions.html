<!doctype html>
<html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Review Submissions – Faculty Console</title><link rel="stylesheet" href="../styles.css"/>
<style>:root{--bg1:#0b1220;--bg2:#0a1b2e}body{margin:0;background:linear-gradient(180deg,var(--bg2),var(--bg1));color:#e7e9f3}.wrap{width:min(1160px,96%);margin:0 auto 40px}.nav{position:fixed;top:0;left:0;right:0;background:linear-gradient(180deg, rgba(10,20,40,.95), rgba(10,20,40,.85));border-bottom:1px solid rgba(148,163,184,.2);backdrop-filter:blur(10px);z-index:10}.nav-inner{max-width:1160px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;justify-content:space-between}main{padding-top:76px}.card{border:1px solid rgba(148,163,184,.28);border-radius:18px;padding:18px;background:linear-gradient(180deg, rgba(2,6,23,.86), rgba(2,6,23,.72));backdrop-filter:blur(12px);box-shadow:0 24px 60px rgba(2,6,23,.55)}.form-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px 14px}.form-grid .field input,.form-grid .field select{border-radius:12px;border:1px solid rgba(148,163,184,.35);background:rgba(15,23,42,.96);padding:10px 12px;width:100%}.data-table{width:100%;border-collapse:separate;border-spacing:0 6px}.data-table thead th{font-weight:600;color:#cbd5f5;font-size:12px;padding:8px 10px;border-bottom:1px solid rgba(148,163,184,.25)}.data-table tbody td{font-size:12px;color:#e5e7eb;padding:8px 10px;background:rgba(2,6,23,.45)}</style></head>
<body><header class="nav"><div class="nav-inner"><div class="nav-left"><strong>Heema Institute of Technology</strong><div class="nav-sub">Faculty Console</div></div><div class="nav-right"><a class="btn btn-outline" href="dashboard.html">← Back to Dashboard</a><button class="btn btn-outline" onclick="Auth.logout()">Logout</button></div></div></header>
<main class="wrap">
<section class="card" style="margin-top:14px"><h2 style="margin:0 0 6px">Review Student Submissions</h2><div class="form-grid" style="margin-top:12px"><div class="field"><label>Class</label><select id="cls"></select></div><div class="field"><label>Assessment</label><select id="asm"></select></div><div class="field"><button class="btn btn-primary" id="load" type="button">Load</button></div></div></section>
<section class="card" style="margin-top:16px"><table class="data-table" id="tbl"><thead><tr><th align="left">Student</th><th align="left">Submitted At</th><th align="left">Files / Text</th><th align="left">Status</th><th align="left">Marks</th><th align="left">Feedback</th><th align="left">Actions</th></tr></thead><tbody></tbody></table></section>
</main>
<script>const API='https://college-management-system-s2yf.onrender.com'; const fid=sessionStorage.getItem('auth_user_id')||''; if((sessionStorage.getItem('auth_role')||'')!=='faculty'){window.location.href='../login.html'}
async function base(){ const r=await fetch(API+'/api/faculty/me',{headers:{'X-Faculty-Id':fid}}); const d=await r.json(); const classes=(d.faculty?.classes||[]); document.getElementById('cls').innerHTML=classes.map(c=>`<option value="${c.id}">${c.name}</option>`).join(''); await loadAssessments(); }
async function loadAssessments(){ const cls=Number(document.getElementById('cls').value); const r=await fetch(API+`/api/faculty/assessments?class_id=${cls}`,{headers:{'X-Faculty-Id':fid}}); const d=await r.json(); document.getElementById('asm').innerHTML=(d.items||[]).map(a=>`<option value="${a.id}">${a.type} • ${a.class_name} • ${(a.course_code||'')+' '+(a.course_name||'')}</option>`).join(''); }
function statusOf(s){ if(!s.submitted_at) return 'Not Submitted'; if(typeof s.marks==='number') return 'Evaluated'; return 'Pending Evaluation'; }
function filesCell(s){ const files = Array.isArray(s.files)? s.files: []; const links = files.map(f=>{ const href = (typeof f.url==='string' && f.url.startsWith('/')) ? (API+f.url) : f.url; return `<a href="${href}" target="_blank" style="color:#93c5fd">${f.filename}</a>`; }).join('<br/>'); const text = s.content_text? `<div class="muted" style="margin-top:4px;max-width:360px;white-space:pre-wrap">${(s.content_text||'').replace(/</g,'&lt;')}</div>`:''; return (links||text)? (links+(links&&text?'<br/>':'')+text): '-'; }
async function load(){ const aid=Number(document.getElementById('asm').value); if(!aid){alert('Select assessment'); return;} const r=await fetch(API+`/api/faculty/submissions?assessment_id=${aid}`,{headers:{'X-Faculty-Id':fid}}); const d=await r.json(); const tbody=document.querySelector('#tbl tbody'); const items=d.items||[]; if(!items.length){tbody.innerHTML=`<tr><td colspan="7" style="color:#9fb0c5">No submissions yet.</td></tr>`; return;} tbody.innerHTML=items.map(s=>`<tr><td>${s.student_name}</td><td>${s.submitted_at?String(s.submitted_at).slice(0,19).replace('T',' '):'-'}</td><td>${filesCell(s)}</td><td>${statusOf(s)}</td><td>${(typeof s.marks==='number')?s.marks:''}</td><td>${s.feedback??''}</td><td><button class='btn btn-outline' data-sub='${s.id}'>Grade</button></td></tr>`).join(''); }
document.addEventListener('click', async (e)=>{ const b=e.target.closest('button[data-sub]'); if(!b) return; const subId=Number(b.dataset.sub); const marksStr=prompt('Enter marks (leave blank to keep):'); const feedback=prompt('Enter feedback (optional):')||null; const payload={ submission_id: subId }; if(marksStr!==null && marksStr!==''){ payload.marks=Number(marksStr); if(Number.isNaN(payload.marks)){ alert('Invalid marks'); return;} } if(feedback!==null){ payload.feedback=feedback; } try{ const r=await fetch(API+'/api/faculty/grade',{method:'POST',headers:{'Content-Type':'application/json','X-Faculty-Id':fid},body:JSON.stringify(payload)}); const d=await r.json(); if(!r.ok){ alert(d.error||'Failed to grade'); return;} await load(); }catch(err){ alert('Network error'); } });
document.getElementById('cls').addEventListener('change', loadAssessments);
document.getElementById('load').addEventListener('click', load);
(async()=>{await base()})();</script>
</body></html>
